# STREET FOODIE APP

A Street Food appreciation PhoneGap & AngularJS mobile app by [Karoly "Charles" Szilagyi](http://charlesagile.com)

[![Get it on Google Play](http://i.imgur.com/Cb2V75V.png)](https://play.google.com/store/apps/details?id=co.getfoodieapp)

![screenshot](http://i.imgur.com/SXcS2xn.png)

![screenshot](http://i.imgur.com/1hMZ2wy.png)

## SOURCE

Public source is hosted on [GitHub](https://github.com/thekarel/street-foodie-app.git)

## INSTALL

```
sudo npm -g install grunt-cli broccoli-cli karma jshint
npm install
```

To be able to use `phonegap serve`, run this once:

```
grunt build
cd phonegap
phonegap install android
phonegap local build android
```

To build PhoneGap app (APK), see Jenkins/CI integration at the end of README

## DEVELOP

### Work on JS, LESS, HTML

```
$ broccoli serve
```

NOTE: all `src/**/*.desktop.js` apps will be compiled to `src/desktop.js` and
will be linked from `index.html`. This way you can add any mock modules to
emulate PhoneGap plugins on desktop, so you have a chance to develop any
non-mocked features in a desktop browser.

The `desktop.js` and the related `<script>` tag is omitted from the PhoneGap
build (see `grunt build`).

## Commit

Before commit, run

```
grunt commit
```

(or simply `grunt`) to run `jshint`

### Tests

Unit tests are run using:

```
grunt unit
```

This will generate `tmp/config.js` and run `karma` using `karma.conf.js`.

Code coverage report is generated into `coverage/` on every Karma run.

### Configuration

Configuration is generated by `config/app-config.js`. It merges defaults with
environment specific overrides. The configuration is `require()`d when used by
Grunt, and it is dumped to a module named `appConfig` into
`build/src/app/app.config.js` on every build or compile (compile will copy
from build).
The AngularJS module is created by the `template` Grunt job.

```
config/
  app-config.js     The configuration generator
  config.tpl        The template for the AngularJS module
  defaults.js       The default values for all configuration
  env-build.js      Values for the *build* environment
  env-compile.js    Values for the *compile* environment
```

**You need to restart Broccoli when changing config!**

### Phonegap workflow

To deploy app assets to `phonegap/www` run

```
cd phonegap
grunt build
grunt replace:androidversion --buildnum=1 --branch=dev
```

(See CI section about `androidversion`)

Install plugins used by modules:

```
phonegap plugin add https://github.com/Telerik-Verified-Plugins/Toast
phonegap plugin add org.apache.cordova.camera
phonegap plugin add org.apache.cordova.splashscreen
phonegap plugin add org.apache.cordova.file
phonegap plugin add add org.apache.cordova.inappbrowser
phonegap plugin add https://github.com/EddyVerbruggen/SocialSharing-PhoneGap-Plugin.git
phonegap plugin add https://github.com/appfeel/admob-google-cordova.git
```

(see `phonegap/plugins/android.json`)

#### Quick install to phone for testing

Connect your phone, then

```
cd phonegap
phonegap install
```

#### PhoneGap `serve`

You can test the app in the
[PhoneGap app](http://app.phonegap.com/) using

```
cd phonegap
phonegap serve
```

Warning! 3rd party plugins will NOT work in the PhoneGap App!
Eg. Toast will not be available, and Camera will just barely work.
Test them on emualtor/device

You can start a Grunt watch so all changes are propagated to PhoneGap
automatically:

In terminal 1 (builds PG and starts watch):

```
grunt stare
```

In terminal 2:

```
cd phonegap
phonegap serve
```

#### Android icons

The 256x256 icon is kept at `phonegap/icon.png`. You can generate all
Android icons by running `phonegap/generate-icon.sh`

*Android Icon & images sizes*

```
drawable 128
drawable-hdpi 72
drawable-ldpi 36
drawable-mdpi 48
drawable-xhdpi 96

drawable-land-hdpi 800*480
drawable-land-ldpi 320*200
drawable-land-mdpi 480*320
drawable-land-xhdpi 1280*720

drawable-port-hdpi 480*800
drawable-port-ldpi 200*320
drawable-port-mdpi 320*480
drawable-port-xhdpi 720*1280
```

## FOLDERS & FILES

The project structure follows [ng-boilerplate](https://github.com/ngbp/ngbp)

```
config/           The configuration generator, defaults and environment overrides
phonegap/         PhoneGap project, `www/` build via `grunt build`
src/              the app specific source
  app/            the app and features
    home/         a feature
    app.js        the main app
    app.spec.js   Unit tests for the app (specs sit next to js files)
  assets/         static files eg. images
  common/         own, non app specific source code
  less/           less file using SMACCS - entry point is main.less
vendor/           3rd party code
```

Any vendor files to copy to release must be listed in the `Brocfile.js`!

## Storage architecture

Angular
Models ie. plain JS objects
Angular DB modules, named *DB.js eg. src/app/food/foodDB.js
  TaffyDB instances
LocalForage
(LocalStorage or similar)

# CI

## Manual setup

* Install Android SDK and Apache Ant. make sure the SDK tools dirs are
in the PATH.

* Install npm dependencies:

```
sudo npm -g install grunt-cli broccoli-cli karma jshint phonegap cordova
```

* Add Credentials Binding Plugin to Jenkins and upload 2 files:

```
streetfoodie.keystore
ant.properties
```

Set the names to `SF_KEYSTORE` and `SF_ANTPROPS`.

## Automated build

Commands are moved to `Build.sh`. So the command to run is

```
sh ./Build.sh
```

# OPEN CODE NOTES

The following changes had to be made so the project can be made public:

* Vendor & market data is removed from `src/assets/data/*`
* Logo and splash screen image removed for licencing reasons
  (`phonegap/icon.png`, `phonegap/screen-*.png`, `src/assets/appmedia/*`),
  the current ones are placeholders
* Google Maps API key and AdMob ID removed from `src/index.html`

# Copyright

(c) 2014 [Karoly "Charles" Szilagyi](http://charlesagile.com) All rights reserved.
